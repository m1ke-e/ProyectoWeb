const datos = [
  {
    id:0,
    img: "/img/ensalada.jpg",
    nombre: "PrimeraEnsalada",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: "4",
  },
  {
    id:1,
    img: "/img/ensalada.jpg",
    nombre: "Segundo",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: "4",
  },

  {
    id:2,
    img: "/img/tacos.jpg",
    nombre: "Tacos al Pastor",
    descripcion: "Tacos con carne al pastor",
    tipo: "Tacos",
    origen: "México",
    precio: 15000,
    disponibilidad: false,
    promocion: "No",
    cantidadPorcion: "Individual",
    puntuacion: 5,
  },

  {
    id:3,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },

  {
    id:4,
    img: "/img/ensalada.jpg",
    nombre: "Ensalada César",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:5,
    img: "/img/ensalada.jpg",
    nombre: "Quinto",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:6,
    img: "/img/ensalada.jpg",
    nombre: "Ensalada César",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:7,
    img: "/img/ensalada.jpg",
    nombre: "Ensalada César",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:8,
    img: "/img/ensalada.jpg",
    nombre: "Ensalada César",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:9,
    img: "/img/ensalada.jpg",
    nombre: "ultimo",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:10,
    img: "/img/ensalada.jpg",
    nombre: "Ensalada César",
    descripcion: "Ensalada con ingredientes variados...",
    tipo: "Ensalada",
    precio: 10000,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:11,
    img: "/img/tacos.jpg",
    nombre: "Todos los 11 son pruebas",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:12,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:13,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:14,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:15,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:16,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:17,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:18,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:19,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:19,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:20,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:21,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:22,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:23,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:24,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:25,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:26,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:27,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:28,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:29,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:30,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:31,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:32,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:33,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:34,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:35,
    img: "/img/tacos.jpg",
    nombre: "11",
    descripcion: "11",
    tipo: "11",
    precio: 11,
    disponibilidad: true,
    origen: "No especificado",
    promocion: "2x1",
    cantidadPorcion: "Individual",
    puntuacion: 4,
  },

  {
    id:37,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:38,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:39,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:40,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:41,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:42,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:43,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:44,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:45,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:46,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:47,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:48,
    img: "/img/vino.jpg",
    nombre: "Cariñoso",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
  {
    id:49,
    img: "/img/vino.jpg",
    nombre: "Ultimo",
    descripcion: "Vino con notas de uva",
    tipo: "Vino",
    origen: "España",
    precio: 120000,
    disponibilidad: true,
    promocion: "Acompañante incluido",
    cantidadPorcion: "10 copas",
    puntuacion: 5,
  },
];

let data = [];
let datosFiltrados = [];
let paginaActual = 1;

const elementosPorPagina = 10;

const llenarTabla = function () {
  const indiceInicio = (paginaActual - 1) * elementosPorPagina;
  const indiceFin = paginaActual * 10;
  data = []
  if(datosFiltrados.length>0){
    for (let i = indiceInicio; i < indiceFin; i++) {
      if(datosFiltrados[i]){
        data[i] = datosFiltrados[i];
      }
    }
  } else{
    for (let i = indiceInicio; i < indiceFin; i++) {
      data[i] = datos[i];
    }
  }

  // Accede a las filas de la tabla y llena los datos
  const filasTabla = document.querySelectorAll("table tr");
  // Renderiza los datos

  var obj;
    for (let i = 0; i < 10; i++) {
      const fila = filasTabla[i + 1]; // Omite la fila de encabezado
      // Limpia la celda de imagen antes de agregar la nueva imagen
      const celdaImagen = fila.children[1]; // Accede a la celda de imagen en la fila actual
      // Mientras haya algún hijo (elemento secundario) en la celda de imagen
      while (celdaImagen.firstChild) {
        // Elimina el primer hijo de la celda de imagen
        celdaImagen.removeChild(celdaImagen.firstChild);
      }

      if (data[indiceInicio + i]) {
        obj = data[indiceInicio + i];
        fila.children[0].innerHTML = obj.id+1;
        // Crea un elemento img
        const imgElement = document.createElement('img');
        imgElement.src = obj.img;

        // Añade el elemento img a la celdaImagen
        celdaImagen.appendChild(imgElement);
        fila.children[2].innerHTML = obj.nombre;
        fila.children[3].innerHTML = obj.descripcion;
        fila.children[4].innerHTML = obj.tipo;
        fila.children[5].innerHTML = obj.precio;
      } else {
        fila.children[0].innerHTML = '';
        fila.children[2].innerHTML = '';
        fila.children[3].innerHTML = '';
        fila.children[4].innerHTML = '';
        fila.children[5].innerHTML = '';
      }
      
      
    }
  actualizarBotonesPaginacion();
};

function cambiarPagina(direccion) {
  paginaActual = paginaActual + direccion;

  if (paginaActual < 1) {
    paginaActual = 1;
  }
  var ultimaPagina = 0;
  if (datosFiltrados.length > 0) {
    ultimaPagina = Math.ceil(datosFiltrados.length / elementosPorPagina);
  } else {
    ultimaPagina = Math.ceil(datos.length / elementosPorPagina);
  }

  if (paginaActual > ultimaPagina) {
    paginaActual = ultimaPagina;
  }

  document.getElementById("pag").innerHTML = "Pagina " + paginaActual;
  llenarTabla();
}

function actualizarBotonesPaginacion() {
  var totalPaginas = 0;
  if (datosFiltrados.length > 0) {
    totalPaginas = Math.ceil(datosFiltrados.length / elementosPorPagina);
  } else {
    totalPaginas = Math.ceil(datos.length / elementosPorPagina);
  }
  const btnAnterior = document.getElementById("anterior");
  const btnSiguiente = document.getElementById("siguiente");
  if (paginaActual === 1) {
    btnAnterior.disabled;
    btnAnterior.style.backgroundColor = "red";
  } else {
    btnAnterior.style.backgroundColor = null;
  }
  if (paginaActual === totalPaginas) {
    btnSiguiente.disabled;
    btnSiguiente.style.backgroundColor = "red";
  } else {
    btnSiguiente.style.backgroundColor = null;
  }
}

document.getElementById("anterior").addEventListener("click", function () {
  cambiarPagina(-1);
});

document.getElementById("siguiente").addEventListener("click", function () {
  cambiarPagina(1);
});

const limpiar = function () {
  datosFiltrados = [];
  paginaActual = 1;
  document.getElementById("pag").innerHTML = "Pagina " + paginaActual;
  llenarTabla();
};

const filtrar = function () {
  const filtroNombre = document
    .getElementById("filtroNombre")
    .value.toLowerCase();
  const filtroTipo = document.getElementById("filtroTipo").value.toLowerCase();

  // Filtrar datos según los criterios de búsqueda
  datosFiltrados = datos.filter(
    (item) =>
      item.nombre.toLowerCase().includes(filtroNombre) &&
      item.tipo.toLowerCase().includes(filtroTipo),
  );

  // Reiniciar la paginación y mostrar los datos filtrados en la primera página
  paginaActual = 1;
  document.getElementById("pag").innerHTML = "Pagina " + paginaActual;
  
  llenarTabla();
};

document.getElementById("filtrar").addEventListener("click", function () {
  filtrar();
});

llenarTabla();

const modalButtons = document.getElementsByClassName("modal-button");

// Itera sobre la colección de elementos y agrega un evento a cada botón
for (let i = 0; i < modalButtons.length; i++) {
  modalButtons[i].addEventListener("click", function (e) {
    // Obtén el número de fila desde el atributo data-fila
    const id = e.target.parentElement.parentElement.children[0].textContent;
    modal1(id);
  });
}

function cerrarModal() {
  const modal = document.getElementById("myModal");
  modal.style.display = "none";
}

function modal1(id) {
  // Abre el modal
  const modal = document.getElementById("myModal");
  

  // Llenar el contenido del modal con la información del platillo y campos editables
  id--;
  modalDetalles.innerHTML = `
  <img src="${datos[id].img}" alt="Imagen de referencia">
  <p>Nombre: <input type="text" id="Nombre" value="${datos[id].nombre}"></p>
  <p>Descripcion: <input type="text" id="Descripcion" value="${datos[id].descripcion}"></p>
  <p>Tipo: <input type="text" id="Tipo" value="${datos[id].tipo}"></p>
  <p>Precio: <input type="number" id="Precio" value="${datos[id].precio}"></p>
  <p>Origen: <input type="text" id="Origen" value="${datos[id].origen}"></p>
  <p>Promocion: <input type="text" id="Promocion" value="${datos[id].promocion}"></p>
  <p>Porciones: <input type="text" id="Cant" value="${datos[id].cantidadPorcion}"></p>
  <p>Puntuacion: <input type="text" id="Puntuacion" value="${datos[id].puntuacion}"></p>
  <button onclick="guardarConRetraso(${datos[id].id})">Guardar cambios</button>
`;
  modal.style.display = "block";
}

function guardarCambios(id) {
  const platillo = datos.find((item) => item.id === id);
  // Actualiza las propiedades del platillo con los valores ingresados en los campos del modal
  platillo.nombre = document.getElementById("Nombre").value;
  platillo.descripcion = document.getElementById("Descripcion").value;
  platillo.tipo = document.getElementById("Tipo").value;
  platillo.precio = parseInt(document.getElementById("Precio").value); // Convierte el precio a número
  platillo.origen = document.getElementById("Origen").value;
  platillo.promocion = document.getElementById("Promocion").value;
  platillo.cantidadPorcion = document.getElementById("Cant").value;
  platillo.puntuacion = document.getElementById("Puntuacion").value;

  llenarTabla();

  cerrarModal();
}

const mensaje=document.getElementById("mensaje");
function guardarConRetraso(id) {
  // Crear una promesa que se resuelva después de dos segundos
  mensaje.innerHTML="Cargando...";
  const promesa = new Promise((resolve) => {
    setTimeout(() => {
      resolve();
    }, 2000);
  });

  // Cuando la promesa se resuelve, ejecutar la función guardarCambios
  promesa.then(() => {
    mensaje.innerHTML="";
    guardarCambios(id);
  });
}
